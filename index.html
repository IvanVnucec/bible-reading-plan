<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblija365</title>
</head>
<body>
    <h1>Biblija365</h1>
    <div>Plan čitanja Biblije kroz čitavu godinu u glasovnom obliku.</div>
    <h2 id="day_of_year">Dan X:</h2>

    <figure id="figure">
        <figcaption>Poslušajte današnje čitanje:</figcaption>
        <audio controls id="audio"></audio>
    </figure>

    <div>
        <small>Dohvaćeno sa <a href="https://www.radiomarija.hr">radiomarija.hr</a>.</small>
    </div>
    <div>
        <small>Made by: <a href="https://github.com/IvanVnucec">Ivan Vnučec</a>, 2024.</small>
    </div>

    <script>
        function getDayOfTheYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = (date - start) + ((start.getTimezoneOffset() - date.getTimezoneOffset()) * 60 * 1000);
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);

            // do not count leap year day
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const isLeapYear = (year % 100 === 0) ? (year % 400 === 0) : (year % 4 === 0);
            const afterFeb29 = month > 2 || (month === 2 && day > 29);
            if (isLeapYear && afterFeb29) {
                return dayOfYear - 1;
            }
            return dayOfYear;
        }

        function onLoad() {
            const now = new Date();
            const dayOfYear = getDayOfTheYear(now);
            document.getElementById('day_of_year').innerText = `Dan ${dayOfYear}:`;

            const month = now.getMonth() + 1;
            const day = now.getDate();
            if (month === 2 && day === 29) {
                document.getElementById('figure').innerHTML = `<p>Obavijest: za današnji dan ne postoji snimljeno čitanje.</p>`;
            } else {
                const monthStr = String(month).padStart(2, '0');
                const dayStr = String(day).padStart(2, '0');
                const src = `https://www.radiomarija.hr/arhiva/biblija365/biblija2022${monthStr}${dayStr}.mp3`;
                document.getElementById('audio').src = src;
                document.getElementById('audio').innerHTML = `<p>Preuzmi <a href="${src}">MP3</a> audio datoteku.</p>`;
            }
        }

        window.onload = onLoad;
    </script>
</body>
</html>